<!-- ========== 左下角备案号右侧添加状态监控指示器 ========== -->
<!-- 
  参考 anheyu-app-frontend-main 前端监控实现
  支持四种状态：loading | ok | partial | error
  动态获取 UptimeRobot 监控状态
-->
<style>
/* 状态指示器容器 */
.footer-uptime-link {
  display: inline-flex;
  align-items: center;
  margin-left: 10px;
  font-size: 14px;
  text-decoration: none !important;
  cursor: pointer;
  transition: transform 0.2s ease;
}

.footer-uptime-link:hover {
  transform: scale(1.05);
}

.footer-uptime-link:hover .footer-uptime-dot {
  transform: scale(1.2);
}

/* 状态点 */
.footer-uptime-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  margin-right: 6px;
  transition: background-color 0.3s, transform 0.2s ease, box-shadow 0.3s;
}

/* 状态文字 */
.footer-uptime-text {
  transition: color 0.3s;
}

/* ========== 加载中状态 ========== */
.footer-uptime-link.status-loading .footer-uptime-dot {
  background-color: #9ca3af;
  animation: statusPulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}
.footer-uptime-link.status-loading .footer-uptime-text {
  color: #9ca3af;
}

/* ========== 正常状态 ========== */
.footer-uptime-link.status-ok .footer-uptime-dot {
  background-color: #10b981;
  box-shadow: 0 0 8px rgba(16, 185, 129, 0.6);
  animation: statusGlow 2s ease-in-out infinite;
}
.footer-uptime-link.status-ok .footer-uptime-text {
  color: #10b981;
}
.footer-uptime-link.status-ok:hover .footer-uptime-dot {
  box-shadow: 0 0 12px rgba(16, 185, 129, 0.8);
}

/* ========== 部分异常状态 ========== */
.footer-uptime-link.status-partial .footer-uptime-dot {
  background-color: #f59e0b;
  box-shadow: 0 0 8px rgba(245, 158, 11, 0.6);
  animation: statusBlink 1.5s ease-in-out infinite;
}
.footer-uptime-link.status-partial .footer-uptime-text {
  color: #f59e0b;
}
.footer-uptime-link.status-partial:hover .footer-uptime-dot {
  box-shadow: 0 0 12px rgba(245, 158, 11, 0.8);
}

/* ========== 错误状态 ========== */
.footer-uptime-link.status-error .footer-uptime-dot {
  background-color: #ef4444;
  box-shadow: 0 0 8px rgba(239, 68, 68, 0.6);
  animation: statusBlink 1s ease-in-out infinite;
}
.footer-uptime-link.status-error .footer-uptime-text {
  color: #ef4444;
}
.footer-uptime-link.status-error:hover .footer-uptime-dot {
  box-shadow: 0 0 12px rgba(239, 68, 68, 0.8);
}

/* ========== 动画定义 ========== */
/* 正常状态的柔和呼吸动画 */
@keyframes statusGlow {
  0%, 100% {
    box-shadow: 0 0 6px rgba(16, 185, 129, 0.5);
    opacity: 1;
  }
  50% {
    box-shadow: 0 0 10px rgba(16, 185, 129, 0.8);
    opacity: 0.9;
  }
}

/* 加载中的脉冲动画 */
@keyframes statusPulse {
  0%, 100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.5;
    transform: scale(0.9);
  }
}

/* 异常/错误时的闪烁动画 */
@keyframes statusBlink {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.4;
  }
}

/* ========== 暗色模式适配（可选） ========== */
@media (prefers-color-scheme: dark) {
  .footer-uptime-link.status-loading .footer-uptime-text {
    color: #6b7280;
  }
}
</style>

<script>
(function () {
  'use strict';

  // ========== 配置项 ==========
  const CONFIG = {
    // 状态页面链接（点击后跳转）
    statusPageUrl: 'https://status.jiugg.fun/',
    // 状态 API 地址（返回状态数据的 PHP 地址）
    statusApiUrl: 'https://your-domain.com/status_api.php',
    // 轮询间隔（毫秒），5分钟
    pollInterval: 5 * 60 * 1000,
    // 初始插入检测间隔（毫秒）
    insertCheckInterval: 500,
    // ICP 备案号匹配正则
    icpPattern: /粤ICP备\d+号?-?\d*/
  };

  // ========== 状态文字映射 ==========
  const STATUS_TEXT = {
    loading: '状态获取中...',
    ok: '所有业务正常',
    partial: '部分服务异常',
    error: '状态获取失败'
  };

  // ========== 当前状态 ==========
  let currentStatus = 'loading';
  let uptimeElement = null;
  let pollTimer = null;

  // ========== 创建状态指示器元素 ==========
  function createUptimeElement() {
    const uptime = document.createElement('a');
    uptime.href = CONFIG.statusPageUrl;
    uptime.target = '_blank';
    uptime.rel = 'noopener';
    uptime.className = 'footer-uptime-link status-loading';
    uptime.title = '查看我的项目状态';
    uptime.innerHTML = `
      <span class="footer-uptime-dot"></span>
      <span class="footer-uptime-text">${STATUS_TEXT.loading}</span>
    `;
    return uptime;
  }

  // ========== 更新状态显示 ==========
  function updateStatus(status) {
    if (!uptimeElement) return;
    
    currentStatus = status;
    
    // 移除所有状态类
    uptimeElement.classList.remove('status-loading', 'status-ok', 'status-partial', 'status-error');
    // 添加新状态类
    uptimeElement.classList.add('status-' + status);
    
    // 更新文字
    const textEl = uptimeElement.querySelector('.footer-uptime-text');
    if (textEl) {
      textEl.textContent = STATUS_TEXT[status] || STATUS_TEXT.error;
    }
  }

  // ========== 获取状态 ==========
  async function fetchStatus() {
    try {
      const response = await fetch(CONFIG.statusApiUrl, {
        method: 'GET',
        headers: {
          'Accept': 'application/json'
        }
      });

      if (!response.ok) {
        console.error('[Uptime Status] API 返回错误:', response.status);
        updateStatus('error');
        return;
      }

      const data = await response.json();
      
      // 根据返回的状态更新显示
      if (data.status === 'ok') {
        updateStatus('ok');
      } else if (data.status === 'partial') {
        updateStatus('partial');
      } else if (data.status === 'error' || data.status === 'down') {
        updateStatus('error');
      } else {
        // 如果返回了监控数据，自行判断状态
        if (data.monitors && Array.isArray(data.monitors)) {
          const hasDown = data.monitors.some(monitor => monitor.status !== 2);
          updateStatus(hasDown ? 'partial' : 'ok');
        } else {
          updateStatus('error');
        }
      }
    } catch (error) {
      console.error('[Uptime Status] 获取状态失败:', error);
      updateStatus('error');
    }
  }

  // ========== 插入状态指示器 ==========
  function insertFooterUptime() {
    // 找到 ICP 备案号元素
    const candidates = Array.from(
      document.querySelectorAll('body *')
    ).filter(el => {
      return el.children.length === 0 &&
             CONFIG.icpPattern.test(el.innerText);
    });

    if (!candidates.length) return false;

    // 一般左下角的是最后一个
    const icpTextEl = candidates[candidates.length - 1];

    // 防止重复插入
    if (icpTextEl.nextSibling &&
        icpTextEl.nextSibling.classList &&
        icpTextEl.nextSibling.classList.contains('footer-uptime-link')) {
      return true;
    }

    // 创建并插入状态指示器
    uptimeElement = createUptimeElement();
    icpTextEl.parentNode.insertBefore(uptimeElement, icpTextEl.nextSibling);

    return true;
  }

  // ========== 开始轮询状态 ==========
  function startPolling() {
    // 立即获取一次状态
    fetchStatus();
    
    // 设置定时轮询
    if (pollTimer) clearInterval(pollTimer);
    pollTimer = setInterval(fetchStatus, CONFIG.pollInterval);
  }

  // ========== 初始化 ==========
  function init() {
    // 轮询检测是否可以插入元素
    let insertTimer = setInterval(() => {
      if (insertFooterUptime()) {
        clearInterval(insertTimer);
        // 插入成功后开始轮询状态
        startPolling();
      }
    }, CONFIG.insertCheckInterval);
  }

  // 页面加载完成后初始化
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }

})();
</script>
